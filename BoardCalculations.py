import random

from tictactoe_symmetry import *

MONOID_LABELS = ('1', 'a', 'b', 'ab', 'b2', 'abc', 'c', 'ac', 'bc', 'abc', 'c2', 'ac2', 'bc2', 'abc2', 'd', 'ad', 'bd',
                 'abd')

# BOARD_VALUES stores the non-constant values of the boards
BOARD_VALUES = {'         ': 6, '    X    ': 10, 'XX       ': 15, 'X X      ': 2,
                'X   X    ': 2, 'X    X   ': 2, 'X       X': 1, ' X X     ': 1,
                ' X  X    ': 2, ' X     X ': 1, 'XX X     ': 2, 'XX  X    ': 3,
                'XX   X   ': 14, 'XX    X  ': 1, 'XX     X ': 14, 'XX      X': 14,
                'X X X    ': 1, 'X X   X  ': 3, 'X X    X ': 1, 'X   XX   ': 1,
                ' X XX    ': 3, ' X X X   ': 2, 'XX XX    ': 1, 'XX X X   ': 1,
                'XX X    X': 1, 'XX  XX   ': 2, 'XX  X X  ': 2, 'XX   XX  ': 2,
                'XX   X X ': 3, 'XX   X  X': 3, 'XX    XX ': 2, 'XX    X X': 2,
                'XX     XX': 1, 'X X X  X ': 2, 'X X   X X': 1, 'X   XX X ': 2,
                ' X X X X ': 1, 'XX X X X ': 2, 'XX X X  X': 2, 'XX  XXX  ': 1,
                'XX   XXX ': 1, 'XX   XX X': 1, 'XX X X XX': 1}

LOOKUP_TABLE = {(6, 9): 13, (10, 17): 17, (7, 12): 12, (1, 17): 16, (0, 7): 7, (13, 17): 14, (14, 17): 13, (1, 6): 7,
                (0, 10): 10, (3, 7): 8, (2, 5): 3, (1, 11): 10, (5, 8): 9, (6, 7): 11, (6, 10): 11, (0, 17): 17,
                (12, 17): 15, (0, 4): 4, (8, 15): 16, (4, 10): 10, (2, 6): 8, (9, 14): 16, (5, 11): 10, (4, 5): 5,
                (10, 13): 13, (4, 16): 16, (9, 16): 14, (14, 15): 11, (2, 17): 15, (14, 16): 12, (0, 1): 1, (3, 12): 11,
                (1, 12): 13, (8, 12): 11, (4, 15): 15, (2, 11): 13, (5, 14): 15, (10, 14): 14, (6, 13): 12,
                (11, 15): 14, (7, 8): 13, (6, 16): 17, (11, 16): 17, (0, 14): 14, (3, 11): 12, (1, 15): 14, (8, 9): 11,
                (4, 12): 12, (2, 12): 10, (3, 17): 14, (6, 14): 15, (7, 15): 15, (12, 13): 11, (1, 16): 17,
                (13, 16): 15, (1, 5): 4, (0, 11): 11, (3, 6): 9, (1, 10): 11, (6, 11): 10, (5, 17): 16, (0, 5): 5,
                (0, 8): 8, (4, 11): 11, (3, 5): 2, (2, 7): 9, (9, 13): 11, (5, 10): 11, (4, 6): 6, (15, 16): 13,
                (5, 7): 6, (4, 17): 17, (7, 17): 17, (0, 2): 2, (3, 15): 16, (1, 3): 2, (8, 13): 10, (4, 8): 8,
                (2, 8): 6, (5, 13): 12, (10, 15): 15, (11, 14): 15, (7, 11): 11, (6, 17): 16, (16, 17): 11, (0, 15): 15,
                (3, 10): 13, (1, 14): 15, (8, 10): 13, (4, 13): 13, (2, 13): 11, (9, 11): 13, (3, 16): 15, (8, 16): 15,
                (6, 15): 14, (11, 13): 12, (7, 14): 14, (12, 14): 16, (13, 15): 16, (1, 4): 5, (0, 12): 12, (3, 9): 6,
                (2, 3): 5, (1, 9): 8, (2, 14): 16, (6, 8): 12, (5, 16): 17, (10, 16): 16, (7, 13): 13, (0, 6): 6,
                (15, 17): 12, (1, 7): 6, (0, 9): 9, (3, 4): 3, (2, 4): 2, (9, 12): 10, (5, 9): 8, (4, 7): 7,
                (10, 11): 11, (5, 6): 7, (0, 16): 16, (7, 16): 16, (12, 16): 14, (0, 3): 3, (3, 14): 17, (1, 2): 3,
                (8, 14): 17, (4, 9): 9, (2, 9): 7, (9, 15): 17, (5, 12): 13, (10, 12): 12, (9, 17): 15, (7, 10): 10,
                (2, 16): 14, (3, 13): 10, (1, 13): 12, (8, 11): 12, (4, 14): 14, (2, 10): 12, (9, 10): 12, (5, 15): 14,
                (8, 17): 14, (6, 12): 13, (11, 12): 13, (7, 9): 12, (12, 15): 17, (11, 17): 16, (13, 14): 17,
                (0, 13): 13, (3, 8): 7, (1, 8): 9, (2, 15): 17}


def board_value(board):
    return random.randint(0, 17)


def multiply(notactoe):
    monoid_list = [get_monoid_index(x, notactoe) for x in range(len(notactoe.board_list))]
    return reduce(lambda m1, m2: combine_monoids(m1, m2), monoid_list)


def combine_monoids(monoid1, monoid2):
    monoid_tuple = tuple(sorted((monoid1, monoid2)))
    return LOOKUP_TABLE[monoid_tuple]


def get_monoid_index(board_index, notactoe):
    symmetry, index = canonical_board(''.join(notactoe.board_list[board_index]))
    if symmetry in BOARD_VALUES:
        return BOARD_VALUES[symmetry]
    return 0

def translate_to_monoid(monoid_index):
    return MONOID_LABELS[monoid_index]